package scripts;

import java.io.*;
import java.lang.String;
import java.util.*;

public class SplitLibraries extends Script {
	public static String title = "Split Libraries";
	public static String b_desc = "Split libraries according to barcodes specified in mapping file";

	public SplitLibraries() {
		// set up script name, command, and descriptions
		this.link = "http://qiime.org/scripts/split_libraries.html";
		this.c_name = SCRIPTS_PATH + "split_libraries.py";
		this.l_desc = "Since newer sequencing technologies provide many reads per run (e.g. the 454 GS FLX Titanium series can produce 400-600 million base pairs with 400-500 base pair read lengths) researchers are now finding it useful to combine multiple samples into a single 454 run. This multiplexing is achieved through the application of a pyrosequencing-tailored nucleotide barcode design (described in (Parameswaran et al., 2007)). By assigning individual, unique sample specific barcodes, multiple sequencing runs may be performed in parallel and the resulting reads can later be binned according to sample. The script split_libraries.py performs this task, in addition to several quality filtering steps including user defined cut-offs for: sequence lengths; end-trimming; minimum quality score. To summarize, by using the fasta, mapping, and quality files, the program split_libraries.py will parse sequences that meet user defined quality thresholds and then rename each read with the appropriate Sample ID, thus formatting the sequence data for downstream analysis. If a combination of different sequencing technologies are used in any particular study, split_libraries.py can be used to perform the quality-filtering for each library individually and the output may then be combined.<br><br>Sequences from samples that are not found in the mapping file (no corresponding barcode) and sequences without the correct primer sequence will be excluded. Additional scripts can be used to exclude sequences that match a given reference sequence (e.g. the human genome; exclude_seqs_by_blast.py) and/or sequences that are flagged as chimeras (identify_chimeric_seqs.py).";
		this.output_desc = "Three files are generated by split_libraries.py:<br><br>1. .fna file (e.g. seqs.fna) - This is a FASTA file containing all sequences which meet the user-defined parameters, where each sequence identifier now contains its corresponding sample id from mapping file.<br>2. histograms.txt- This contains the counts of sequences with a particular length.<br>3. split_library_log.txt - This file contains a summary of the split_libraries.py analysis. Specifically, this file includes information regarding the number of sequences that pass quality control (number of seqs written) and how these are distributed across the different samples which, through the use of bar-coding technology, would have been pooled into a single 454 run. The number of sequences that pass quality control will depend on length restrictions, number of ambiguous bases, max homopolymer runs, barcode check, etc. All of these parameters are summarized in this file. If raw sequences do not meet the specified quality thresholds they will be omitted from downstream analysis. Since we never see a perfect 454 sequencing run, the number of sequences written should always be less than the number of raw sequences. The number of sequences that are retained for analysis will depend on the quality of the 454 run itself in addition to the default data filtering thresholds in the split_libraries.py script. The default parameters (minimum quality score = 25, minimum/maximum length = 200/1000, no ambiguous bases allowed, no mismatches allowed in primer sequence) can be adjusted to meet the user’s needs.";

		// set up the required otpions
		this.r_options = new ArrayList<Option>(2);
		this.r_options.add(new Option("Mapping File", "-m", Option.PATH, "Name of mapping file. NOTE: Must contain a header line indicating SampleID in the first column and BarcodeSequence in the second, LinkerPrimerSequence in the third."));
		this.r_options.add(new Option("FASTA Files", "-f", Option.PATH, 0, "Names of fasta files, comma-delimited"));

		// set up the extra options
		this.e_options = new ArrayList<Option>(26);
		this.e_options.add(new Option("QUAL Files", "-q", Option.PATH, 0, "Names of qual files, comma-delimited [default: None]"));
		this.e_options.add(new Option("Remove Unassigned?", "-r", Option.NOARG, "DEPRECATED: pass –retain_unassigned_reads to keep unassigned reads [default: None]"));
		this.e_options.add(new Option("Min Sequence Length", "-l", Option.NUM, "Minimum sequence length, in nucleotides [default: 200]"));
		this.e_options.add(new Option("Max Sequence Length", "-L", Option.NUM, "Maximum sequence length, in nucleotides [default: 1000]"));
		this.e_options.add(new Option("Trim Sequence Length?", "-t", Option.NOARG, "Calculate sequence lengths after trimming primers and barcodes [default: False]"));
		this.e_options.add(new Option("Min QUAL Score", "-s", Option.NUM, "Min average qual score allowed in read [default: 25]"));
		this.e_options.add(new Option("Keep Primer?", "-k", Option.NOARG, "Do not remove primer from sequences"));
		this.e_options.add(new Option("Keep Barcode?", "-B", Option.NOARG, "Do not remove barcode from sequences"));
		this.e_options.add(new Option("Max Ambiguous Bases", "-a", Option.NUM, "Maximum number of ambiguous bases [default: 6]"));
		this.e_options.add(new Option("Max Homopolymoer", "-H", Option.NUM, "Maximum length of homopolymer run [default: 6]"));
		this.e_options.add(new Option("Max Primer Mismatch", "-M", Option.NUM, "Maximum number of primer mismatches [default: 0]"));
		this.e_options.add(new Option("Barcode Type", "-b", Option.INPUT, "Barcode type, hamming_8, golay_12, variable_length (will disable any barcode correction if variable_length set), or a number representing the length of the barcode, such as -b 4. [default: golay_12]"));
		this.e_options.add(new Option("Output", "-o", Option.PATH, "Directory prefix for output files [default: .]"));
		this.e_options.add(new Option("Max Barcode Errors", "-e", Option.NUM, "Maximum number of errors in barcode [default: 1.5]"));
		this.e_options.add(new Option("Start Numbering At", "-n", Option.NUM, "Seq id to use for the first sequence [default: 1]"));
		this.e_options.add(new Option("Retain Unassigned Reads?", "--retain_unassigned_reads", Option.NOARG, "Retain sequences which are Unassigned in the output sequence file[default: False]"));
		this.e_options.add(new Option("Disable Barcode Correction?", "-c", Option.NOARG, "Disable attempts to find nearest corrected barcode. Can improve performance. [default: False]"));
		this.e_options.add(new Option("QUAL Scpre Window", "-w", Option.NUM, "Enable sliding window test of quality scores. If the average score of a continuous set of w nucleotides falls below the threshold (see -s for default), the sequence is discarded. A good value would be 50. 0 (zero) means no filtering. Must pass a .qual file (see -q parameter) if this functionality is enabled. Default behavior for this function is to truncate the sequence at the beginning of the poor quality window, and test for minimal length (-l parameter) of the resulting sequence. [default: 0]"));
		this.e_options.add(new Option("Discard Bad Windows", "-g", Option.NOARG, "If the qual_score_window option (-w) is enabled, this will override the default truncation behavior and discard any sequences where a bad window is found. [default: False]"));
		this.e_options.add(new Option("Disable Primers?", "-p", Option.NOARG, "Disable primer usage when demultiplexing. Should be enabled for unusual circumstances, such as analyzing Sanger sequence data generated with different primers. [default: False]"));
		this.e_options.add(new Option("Reverse Primers", "-z", Option.NOARG, "Enable removal of the reverse primer and any subsequence sequence from the end of each read. To enable this, there has to be a “ReversePrimer” column in the mapping file. Primers a required to be in IUPAC format and written in the 5’ to 3’ direction. Valid options are ‘disable’, ‘truncate_only’, and ‘truncate_remove’. ‘truncate_only’ will remove the primer and subsequent sequence data from the output read and will not alter output of sequences where the primer cannot be found. ‘truncate_remove’ will flag sequences where the primer cannot be found to not be written and will record the quantity of such failed sequences in the log file. [default: disable]"));
		this.e_options.add(new Option("Reverse Primers Mismatches", "--", Option.NUM, "Set number of allowed mismatches for reverse primers (option -z). [default: 0]"));
		this.e_options.add(new Option("Record QUAL Scores?", "-d", Option.NOARG, "Enables recording of quality scores for all sequences that are recorded. If this option is enabled, a file named seqs_filtered.qual will be created in the output directory, and will contain the same sequence IDs in the seqs.fna file and sequence quality scores matching the bases present in the seqs.fna file. [default: False]"));
		this.e_options.add(new Option("Median Length Filtering?", "-i", Option.NOARG, "Disables minimum and maximum sequence length filtering, and instead calculates the median sequence length and filters the sequences based upon the number of median absolute deviations specified by this parameter. Any sequences with lengths outside the number of deviations will be removed. [default: None]"));
		this.e_options.add(new Option("Added Demultiplex Field", "-j", Option.INPUT, "Use -j to add a field to use in the mapping file as an additional demultiplexing option to the barcode. All combinations of barcodes and the values in these fields must be unique. The fields must contain values that can be parsed from the fasta labels such as “plate=R_2008_12_09”. In this case, “plate” would be the column header and “R_2008_12_09” would be the field data (minus quotes) in the mapping file. To use the run prefix from the fasta label, such as “>FLP3FBN01ELBSX”, where “FLP3FBN01” is generated from the run ID, use “-j run_prefix” and set the run prefix to be used as the data under the column headerr “run_prefix”. [default: None]"));
		this.e_options.add(new Option("Truncate Ambi Bases?", "-x", Option.NOARG, "Enable to truncate at the first “N” character encountered in the sequences. This will disable testing for ambiguous bases (-a option) [default: False]"));
	
	}
}